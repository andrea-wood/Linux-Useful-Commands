# 							
# Linux-Useful-Commands	
#

# list all directories > 1GB in the partition
du -h <dir> | grep '^\s*[0-9\.]\+G'

# total size of the current directory including all the subdirectories
du -ch | grep total

# This displays a summary of the directory size. It is the simplest way to know the total size of the current directory
du -s

# Export All Databases Mysql
mysqldump -u root -p --all-databases | gzip > {database}.sql.gz
mysqldump -u root -p --opt --nanoall-databases > alldb.sql
mysqldump -u root -p --all-databases --skip-lock-tables > alldb.sql

# Using tar and ssh to efficiently copy files preserving permissions
tar zcvf - /dir/ | ssh -p port_number user@host "tar zxv -C /dir/"

#
# SCREEN 
#

# Starting Linux Screen
screen
# Detaching From Screen
Ctrl-a + d
# Creating Windows
Ctrl-a + c
# Switching Between Windows
Ctrl-a + n
# Attach to a session which is already attached elsewhere
screen -x (if you have multiple screens: screen -r  31844.pts-0.office)
# Create a running log of the session
Ctrl-a + H
# Getting Alerts
Ctrl-a + M 
# To monitor for silence or no output 
Ctrl-a + _
# Locking Your Screen Session
Ctrl-a + x
# Stopping Screen
Ctrl-a + k or exit


# To append the string to file 
echo "hello" >> greetings.txt
# To append the contents of the file temp.txt to file data.txt
cat temp.txt >> data.txt
# To append the current date/time timestamp to the file dates.txt
date >> dates.txt

#
# SSH
#

# check if ssh is running
ps aux | grep sshd
# check if the process sshd is listening on port 22
netstat -plant | grep :22
# check if the port 22 TCP file is open
lsof -i | grep sshd

## Signature Authentication Openwrt ##

1. Generate Private Key using PuTTYgen (type: SSH2-RSA)
2. [FOR WINDOWS] Export private key to openssh format in Conversions -> Export OpenSSH Key (without passphrase)
3. Send the key on the router via ftp or ssh (ssh root@openwrt "echo $(cat ~/.ssh/private_key) >>/etc/dropbear/private_key_openssh)
4. Convert openssh format key to dropbear format with dropbearconvert: dropbearconvert openssh dropbear private_key_openssh private_key_dropbear
5. Extract public key from private key: dropbearkey -y -t rsa -f /etc/dropbear/private_key_dropbear
6. Create if not exist file authorized_keys and copy the public key: cat /etc/dropbear/private_key_dropbear >> /etc/dropbear/authorized_keys && chmod 0600 /etc/dropbear/authorized_keys
7. Add passphrase on PuttyGen and save the private key
8. Run Pageant and add the new key


## FIX FULL QMAIL QUEUE ##
# See messages in queue
tail -f /var/log/qmail/current
df
# Stop qmail
/etc/rc.d/init.d/qmail stop
cd /var/qmail/
ls -l
# remove queue directory
rm -rf queue
# check space
df
# to queue again use qmail repair at http://pyropus.ca/software/queue-repair/queue-repair-0.9.0.tar.gz
mkdir /temp
cd /temp
wget http://pyropus.ca/software/queue-repair/queue-repair-0.9.0.tar.gz
tar xfz queue-repair-0.9.0.tar.gz
cd queue-repair-0.9.0
./queue_repair.py -c -s 23 --no-bigtodo .
# check if queue dir is created in the temp dir
ls -l queue
# repair qmail for real
./queue_repair.py -c -s 23 --no-bigtodo /var/qmail
 ls -l /var/qmail/
# restart qmail
/etc/rc.d/init.d/qmail start
# test qmail
